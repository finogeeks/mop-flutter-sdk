stages:
  - update
  - check
  - build
variables:
  LC_ALL: "en_US.UTF-8"
  LANG: "en_US.UTF-8"
  GITLAB_VERSION: $GITLAB_VERSION
  GITLAB_IOS_VERSION: $GITLAB_IOS_VERSION
  GITLAB_ANDROID_VERSION: $GITLAB_ANDROID_VERSION
  GITLAB_BUILD_DEPLOY: $GITLAB_BUILD_DEPLOY

workflow:
  rules:
    - if: '$GITLAB_BUILD_DEPLOY == "true" && $GITLAB_VERSION != null && $GITLAB_VERSION != ""'
    - when: never

update:
  stage: update
  script: 
    - |
      # 使用 eval 确保变量被正确展开
      IOS_VERSION=$(eval echo ${GITLAB_IOS_VERSION:-""})
      ANDROID_VERSION=$(eval echo ${GITLAB_ANDROID_VERSION:-""})
      
      # 打印检查
      echo "检查变量值："
      echo "Version: $GITLAB_VERSION"
      echo "iOS Version: '$IOS_VERSION'"
      echo "Android Version: '$ANDROID_VERSION'"
      
      # 使用 eval 确保变量被正确传递
      sh -c "sh update_version.sh '$GITLAB_VERSION' '$IOS_VERSION' '$ANDROID_VERSION'"

check:
  stage: check
  script: 
    - echo "check build flutter sdk"

build:
  stage: build
  script:
    # 编译
    - echo "start build flutter sdk"
    # - sh bundle.sh $GITLAB_VERSION $GITLAB_IOS_VERSION $GITLAB_ANDROID_VERSION $GITLAB_BUILD_DEPLOY
  tags:
    - mac-studio
  only:
    - web
    - api
    - pipelines
  



